!function(){"use strict";const e={formSelector:".modal__form",inputSelector:".modal__input",submitButtonSelector:".modal__submit-btn",inactiveButtonClass:"modal__submit-btn_disabled",inputErrorClass:"modal__input_type_error",errorClass:"modal__error"},t=(e,t,r)=>{e.querySelector(`#${t.id}-error`).textContent="",t.classList.remove(r.inputErrorClass)},r=(e,t,r)=>{(e=>e.some(e=>!e.validity.valid))(e)?n(t,r):(t.disabled=!1,t.classList.remove(r.inactiveButtonClass))},n=(e,t)=>{e.disabled=!0,console.log(t),e.classList.add(t.inactiveButtonClass)};function a(e,t,r="Save",n="Saving..."){t?(e.textContent=n,e.disabled=!0):(e.textContent=r,e.disabled=!1)}function o(e,t,r="Delete",n="Deleting..."){t?(e.textContent=n,e.disabled=!0):(e.textContent=r,e.disabled=!1)}const s=new class{constructor({baseUrl:e,headers:t}){this._baseUrl=e,this._headers=t}_handleServerResponse(e){return e.ok?e.json():Promise.reject(`Error: ${e.status}`)}getAppInfo(){return Promise.all([this.getInitialCards(),this.getUserInfo()])}async getInitialCards(){const e=await fetch(`${this._baseUrl}/cards`,{headers:this._headers});return this._handleServerResponse(e)}getUserInfo(){return fetch(`${this._baseUrl}/users/me`,{headers:this._headers}).then(this._handleServerResponse)}editUserInfo({name:e,about:t}){return fetch(`${this._baseUrl}/users/me`,{method:"PATCH",headers:this._headers,body:JSON.stringify({name:e,about:t})}).then(e=>this._handleServerResponse(e))}addCards({name:e,link:t}){return fetch(`${this._baseUrl}/cards`,{method:"POST",headers:this._headers,body:JSON.stringify({name:e,link:t})}).then(e=>this._handleServerResponse(e))}changeLikeStatus(e,t){return fetch(`${this._baseUrl}/cards/${e}/likes`,{method:t?"DELETE":"PUT",headers:this._headers}).then(this._handleServerResponse)}editUserAvatar({avatar:e}){return fetch(`${this._baseUrl}/users/me/avatar`,{method:"PATCH",headers:this._headers,body:JSON.stringify({avatar:e})}).then(this._handleServerResponse)}deleteCard(e){return fetch(`${this._baseUrl}/cards/${e}`,{method:"delete",headers:this._headers}).then(this._handleServerResponse)}}({baseUrl:"https://around-api.en.tripleten-services.com/v1",headers:{authorization:"397ad35c-b1dc-4afd-a845-5f2004b6d0d1","Content-Type":"application/json"}});s.getAppInfo().then(([e,t])=>{R.textContent=t.name,D.textContent=t.about,c.src=t.avatar,e.forEach(e=>{const t=H(e);J.append(t)})}).catch(console.error);const c=document.querySelector(".profile__avatar"),l=document.querySelector(".profile__edit-btn"),i=document.querySelector("#edit-profile-modal"),d=i.querySelector(".modal__close-btn"),u=i.querySelector(".modal__form"),m=i.querySelector(".modal__submit-btn"),_=i.querySelector("#profile-name-input"),h=i.querySelector("#profile-description-input"),v=document.querySelector(".profile__add-btn"),f=document.querySelector("#new-post-modal"),S=f.querySelector(".modal__close-btn"),y=f.querySelector(".modal__form"),b=f.querySelector(".modal__submit-btn"),p=f.querySelector("#card-image-input"),q=f.querySelector("#card-caption-input"),L=document.querySelector("#edit-avatar-modal"),E=L.querySelector(".modal__close-btn"),k=document.querySelector(".profile__avatar-btn"),C=L.querySelector(".modal__form"),g=L.querySelector(".modal__submit-btn"),U=L.querySelector("#profile-avatar-input"),x=document.querySelector("#preview-modal"),$=x.querySelector(".modal__close-btn"),A=x.querySelector(".modal__image"),I=x.querySelector(".modal__caption"),R=document.querySelector(".profile__name"),D=document.querySelector(".profile__description"),w=document.querySelector("#delete-avatar-modal"),P=w.querySelector(".modal__close-btn_delete"),T=w.querySelector(".modal__submit-btn-cancle"),B=w.querySelector(".modal__form");let N,O;w.querySelector(".modal__submit-btn"),B.addEventListener("submit",function(e){e.preventDefault();const t=e.submitter;o(t,!0),s.deleteCard(O).then(()=>{N.remove(),M(w)}).catch(console.error).finally(()=>{o(t,!1)})}),T.addEventListener("click",function(){M(w)});const j=document.querySelector("#card-template").content.querySelector(".card"),J=document.querySelector(".cards__list");function H(e){let t=j.cloneNode(!0);const r=t.querySelector(".card__title"),n=t.querySelector(".card__image"),a=t.querySelector(".card__like-btn");return n.src=e.link,n.alt=e.name,r.textContent=e.name,e.isLiked&&a.classList.add("card__like-btn_active"),a.addEventListener("click",t=>{!function(e,t){const r=e.target.classList.contains("card__like-btn_active");s.changeLikeStatus(t._id,r).then(()=>e.target.classList.toggle("card__like-btn_active"))}(t,e)}),t.querySelector(".card__delete-btn").addEventListener("click",()=>{O=e._id,N=t,z(w)}),n.addEventListener("click",()=>{A.src=e.link,A.alt=e.name,I.textContent=e.name,z(x)}),t}function z(e){e.classList.add("modal_is-opened"),document.addEventListener("keydown",F)}function M(e){e.classList.remove("modal_is-opened"),document.removeEventListener("keydown",F)}function F(e){"Escape"===e.key&&M(document.querySelector(".modal_is-opened"))}var G;$.addEventListener("click",function(){M(x)}),l.addEventListener("click",function(){var r,n;r=u,n=e,[_,h].forEach(e=>{t(r,e,n)}),z(i),_.value=R.textContent,h.value=D.textContent}),d.addEventListener("click",function(){M(i)}),v.addEventListener("click",function(){z(f)}),S.addEventListener("click",function(){M(f)}),k.addEventListener("click",function(){z(L)}),E.addEventListener("click",function(){M(L)}),P.addEventListener("click",function(){M(w)}),u.addEventListener("submit",function(t){t.preventDefault();const r=t.submitter;a(r,!0),s.editUserInfo({name:_.value,about:h.value}).then(t=>{R.textContent=t.name,D.textContent=t.about,c.src=t.avatar,n(m,e),M(i)}).catch(console.error).finally(()=>{a(r,!1)})}),C.addEventListener("submit",function(t){t.preventDefault();const r=t.submitter;a(r,!0),s.editUserAvatar({avatar:U.value}).then(r=>{c.src=r.avatar,M(L),t.target.reset(),n(g,e)}).catch(console.error).finally(()=>{a(r,!1)})}),y.addEventListener("submit",function(t){t.preventDefault();const r=t.submitter;a(r,!0);const o={name:q.value,link:p.value};s.addCards(o).then(r=>{const a=H(r);J.prepend(a),t.target.reset(),n(b,e),M(f)}).catch(console.error).finally(()=>{a(r,!1)})}),document.querySelectorAll(".modal").forEach(e=>{e.addEventListener("click",t=>{t.target.classList.contains("modal")&&M(e)})}),G=e,document.querySelectorAll(G.formSelector).forEach(e=>{((e,n)=>{const a=Array.from(e.querySelectorAll(n.inputSelector)),o=e.querySelector(n.submitButtonSelector);r(a,o,n),a.forEach(s=>{s.addEventListener("input",function(){((e,r,n)=>{r.validity.valid?t(e,r,n):((e,t,r,n)=>{e.querySelector(`#${t.id}-error`).textContent=r,t.classList.add(n.inputErrorClass)})(e,r,r.validationMessage,n)})(e,s,n),r(a,o,n)})})})(e,G)})}();
//# sourceMappingURL=data:application/json;charset=utf-8;base64,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QTVDWG1DLEVBQUMvSSxFQUFRQyxFQUFTQyxLQUN0Q0QsRUFBUVksU0FBU0MsTUFHcEJmLEVBQWVDLEVBQVFDLEVBQVNDLEdBaEJiOEksRUFBQ2hKLEVBQVFDLEVBQVNnSixFQUFVL0ksS0FDOUJGLEVBQU9HLGNBQWMsSUFBSUYsRUFBUUcsWUFDekNDLFlBQWM0SSxFQUN6QmhKLEVBQVFLLFVBQVVjLElBQUlsQixFQUFPTCxrQkFXM0JtSixDQUFlaEosRUFBUUMsRUFBU0EsRUFBUWlKLGtCQUFtQmhKLElBMkN6RDZJLENBQW1CL0ksRUFBUUMsRUFBU0MsR0FDcENNLEVBQWtCQyxFQUFXQyxFQUFVUixFQUN6QyxNQU9BMEksQ0FBaUI1SSxFQUFRRSxJIiwic291cmNlcyI6WyJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy9zY3JpcHRzL3ZhbGlkYXRpb24uanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy91dGlscy9oZWxwZXJzLmpzIiwid2VicGFjazovL3NlX3Byb2plY3Rfc3BvdHMvLi9zcmMvcGFnZXMvaW5kZXguanMiLCJ3ZWJwYWNrOi8vc2VfcHJvamVjdF9zcG90cy8uL3NyYy91dGlscy9BcGkuanMiXSwic291cmNlc0NvbnRlbnQiOlsiZXhwb3J0IGNvbnN0IHNldHRpbmdzID0ge1xuICBmb3JtU2VsZWN0b3I6IFwiLm1vZGFsX19mb3JtXCIsXG4gIGlucHV0U2VsZWN0b3I6IFwiLm1vZGFsX19pbnB1dFwiLFxuICBzdWJtaXRCdXR0b25TZWxlY3RvcjogXCIubW9kYWxfX3N1Ym1pdC1idG5cIixcbiAgaW5hY3RpdmVCdXR0b25DbGFzczogXCJtb2RhbF9fc3VibWl0LWJ0bl9kaXNhYmxlZFwiLFxuICBpbnB1dEVycm9yQ2xhc3M6IFwibW9kYWxfX2lucHV0X3R5cGVfZXJyb3JcIixcbiAgZXJyb3JDbGFzczogXCJtb2RhbF9fZXJyb3JcIlxufVxuXG5cbmNvbnN0IHNob3dJbnB1dEVycm9yID0gKGZvcm1FbCwgaW5wdXRFbCwgZXJyb3JNc2csIGNvbmZpZykgPT4ge1xuICBjb25zdCBlcnJvck1zZ0VsID0gZm9ybUVsLnF1ZXJ5U2VsZWN0b3IoYCMke2lucHV0RWwuaWR9LWVycm9yYCk7XG4gIGVycm9yTXNnRWwudGV4dENvbnRlbnQgPSBlcnJvck1zZztcbiAgaW5wdXRFbC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xufTtcblxuY29uc3QgaGlkZUlucHV0RXJyb3IgPSAoZm9ybUVsLCBpbnB1dEVsLCBjb25maWcpID0+IHtcbiAgY29uc3QgZXJyb3JNc2dFbCA9IGZvcm1FbC5xdWVyeVNlbGVjdG9yKGAjJHtpbnB1dEVsLmlkfS1lcnJvcmApO1xuICBlcnJvck1zZ0VsLnRleHRDb250ZW50ID0gXCJcIjtcbiAgaW5wdXRFbC5jbGFzc0xpc3QucmVtb3ZlKGNvbmZpZy5pbnB1dEVycm9yQ2xhc3MpO1xufTtcblxuY29uc3QgY2hlY2tJbnB1dFZhbGlkaXR5ID0gKGZvcm1FbCwgaW5wdXRFbCwgY29uZmlnKSA9PiB7XG4gIGlmICghaW5wdXRFbC52YWxpZGl0eS52YWxpZCkge1xuICAgIHNob3dJbnB1dEVycm9yKGZvcm1FbCwgaW5wdXRFbCwgaW5wdXRFbC52YWxpZGF0aW9uTWVzc2FnZSwgY29uZmlnKTtcbiAgfSBlbHNlIHtcbiAgICBoaWRlSW5wdXRFcnJvcihmb3JtRWwsIGlucHV0RWwsIGNvbmZpZyk7XG4gIH1cbn07XG5cbmNvbnN0IGhhc0ludmFsaWRJbnB1dCA9IChpbnB1dExpc3QpID0+IHtcbiAgcmV0dXJuIGlucHV0TGlzdC5zb21lKChpbnB1dCkgPT4ge1xuICAgIHJldHVybiAhaW5wdXQudmFsaWRpdHkudmFsaWQ7XG4gIH0pO1xufTtcblxuY29uc3QgdG9nZ2xlQnV0dG9uU3RhdGUgPSAoaW5wdXRMaXN0LCBidXR0b25FbCwgY29uZmlnKSA9PiB7XG4gIGlmIChoYXNJbnZhbGlkSW5wdXQoaW5wdXRMaXN0LCBjb25maWcpKSB7XG4gICAgZGlzYWJsZUJ1dHRvbihidXR0b25FbCwgY29uZmlnKTtcbiAgfSBlbHNlIHtcbiAgICBidXR0b25FbC5kaXNhYmxlZCA9IGZhbHNlO1xuICAgIGJ1dHRvbkVsLmNsYXNzTGlzdC5yZW1vdmUoY29uZmlnLmluYWN0aXZlQnV0dG9uQ2xhc3MpO1xuICB9XG59O1xuXG5leHBvcnQgY29uc3QgZGlzYWJsZUJ1dHRvbiA9IChidXR0b25FbCwgY29uZmlnKSA9PiB7XG4gIGJ1dHRvbkVsLmRpc2FibGVkID0gdHJ1ZTtcbiAgY29uc29sZS5sb2coY29uZmlnKVxuICBidXR0b25FbC5jbGFzc0xpc3QuYWRkKGNvbmZpZy5pbmFjdGl2ZUJ1dHRvbkNsYXNzKTtcbn07XG5cbi8vaSBuZWVkIGhlbHAgaGVyZSB0byBoZWxwIGkgd2FudCB0byByZW1vdmUgdGhlZSByZWQgYm9yZGVyIGltIHRoaW5raW5nIGNsYXNzTGlzdC5yZW1vdmVcbmV4cG9ydCBjb25zdCByZXNldFZhbGlkYXRpb24gPSAoZm9ybUVsLCBpbnB1dExpc3QsIGNvbmZpZykgPT4ge1xuaW5wdXRMaXN0LmZvckVhY2goKGlucHV0KSA9PiB7IGhpZGVJbnB1dEVycm9yKGZvcm1FbCwgaW5wdXQsIGNvbmZpZylcbiAgLy9kb3QgdG9sZCBtZSB0byBhZGQgdGhpcyB0byBtYWtlIGl0IHdvcmsgYnV0IHdoeSBkb3NlIGl0IGhpZGVJbnB1dEVycm9yO1xufSk7XG59O1xuXG5jb25zdCBzZXRFdmVudExpc3RuZXJzID0gKGZvcm1FbCwgY29uZmlnKSA9PiB7XG4gIGNvbnN0IGlucHV0TGlzdCA9IEFycmF5LmZyb20oZm9ybUVsLnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmlucHV0U2VsZWN0b3IpKTtcbiAgY29uc3QgYnV0dG9uRWwgPSBmb3JtRWwucXVlcnlTZWxlY3Rvcihjb25maWcuc3VibWl0QnV0dG9uU2VsZWN0b3IpO1xuXG5cbiAgdG9nZ2xlQnV0dG9uU3RhdGUoaW5wdXRMaXN0LCBidXR0b25FbCwgY29uZmlnKTtcblxuICBpbnB1dExpc3QuZm9yRWFjaCgoaW5wdXRFbCkgPT4ge1xuICAgIGlucHV0RWwuYWRkRXZlbnRMaXN0ZW5lcihcImlucHV0XCIsIGZ1bmN0aW9uICgpIHtcbiAgICAgIGNoZWNrSW5wdXRWYWxpZGl0eShmb3JtRWwsIGlucHV0RWwsIGNvbmZpZyk7XG4gICAgICB0b2dnbGVCdXR0b25TdGF0ZShpbnB1dExpc3QsIGJ1dHRvbkVsLCBjb25maWcpO1xuICAgIH0pO1xuICB9KTtcbn07XG5cbmV4cG9ydCBjb25zdCBlbmFibGVWYWxpZGF0aW9uID0gKGNvbmZpZykgPT4ge1xuICBjb25zdCBmb3JtTGlzdCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3JBbGwoY29uZmlnLmZvcm1TZWxlY3Rvcik7XG4gIGZvcm1MaXN0LmZvckVhY2goKGZvcm1FbCkgPT4ge1xuICAgIHNldEV2ZW50TGlzdG5lcnMoZm9ybUVsLCBjb25maWcpO1xuICB9KTtcbn07XG5cblxuIiwiZXhwb3J0IGZ1bmN0aW9uIHNldEJ1dHRvblRleHQoXG4gIGJ1dHRvbixcbiAgaXNMb2FkaW5nLFxuICBkZWZhdWx0VGV4dCA9IFwiU2F2ZVwiLFxuICBsb2FkaW5nVGV4dCA9IFwiU2F2aW5nLi4uXCJcbikge1xuICBpZiAoaXNMb2FkaW5nKSB7XG4gICAgYnV0dG9uLnRleHRDb250ZW50ID0gbG9hZGluZ1RleHQ7XG4gICAgYnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcbiAgfSBlbHNlIHtcbiAgICBidXR0b24udGV4dENvbnRlbnQgPSBkZWZhdWx0VGV4dDtcbiAgICBidXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcbiAgfVxufVxuXG5leHBvcnQgZnVuY3Rpb24gZGVsZXRlQnV0dG9uVGV4dChcbiAgYnV0dG9uLFxuICBpc0xvYWRpbmcsXG4gIGRlZmF1bHRUZXh0ID0gXCJEZWxldGVcIixcbiAgbG9hZGluZ1RleHQgPSBcIkRlbGV0aW5nLi4uXCJcbikge1xuICBpZiAoaXNMb2FkaW5nKSB7XG4gICAgYnV0dG9uLnRleHRDb250ZW50ID0gbG9hZGluZ1RleHQ7XG4gICAgYnV0dG9uLmRpc2FibGVkID0gdHJ1ZTtcbiAgfSBlbHNlIHtcbiAgICBidXR0b24udGV4dENvbnRlbnQgPSBkZWZhdWx0VGV4dDtcbiAgICBidXR0b24uZGlzYWJsZWQgPSBmYWxzZTtcbiAgfVxufVxuIiwiaW1wb3J0IFwiLi9pbmRleC5jc3NcIjtcbmltcG9ydCBcIi4uL3V0aWxzL2hlbHBlcnMuanNcIjtcbmltcG9ydCB7XG4gIGVuYWJsZVZhbGlkYXRpb24sXG4gIHNldHRpbmdzLFxuICByZXNldFZhbGlkYXRpb24sXG4gIGRpc2FibGVCdXR0b24sXG59IGZyb20gXCIuLi9zY3JpcHRzL3ZhbGlkYXRpb24uanNcIjtcbmltcG9ydCBBcGkgZnJvbSBcIi4uL3V0aWxzL0FwaS5qc1wiO1xuaW1wb3J0IHsgc2V0QnV0dG9uVGV4dCwgZGVsZXRlQnV0dG9uVGV4dCB9IGZyb20gXCIuLi91dGlscy9oZWxwZXJzLmpzXCI7XG5cbmNvbnN0IGFwaSA9IG5ldyBBcGkoe1xuICBiYXNlVXJsOiBcImh0dHBzOi8vYXJvdW5kLWFwaS5lbi50cmlwbGV0ZW4tc2VydmljZXMuY29tL3YxXCIsXG4gIGhlYWRlcnM6IHtcbiAgICBhdXRob3JpemF0aW9uOiBcIjM5N2FkMzVjLWIxZGMtNGFmZC1hODQ1LTVmMjAwNGI2ZDBkMVwiLCAvLyBSZXBsYWNlIHdpdGggeW91ciBhY3R1YWwgdG9rZW5cbiAgICBcIkNvbnRlbnQtVHlwZVwiOiBcImFwcGxpY2F0aW9uL2pzb25cIixcbiAgfSxcbn0pO1xuXG4vLyBBUEkgaW5pdGlhbGl6YXRpb24gYW5kIGluaXRpYWwgZGF0YSBmZXRjaFxuYXBpXG4gIC5nZXRBcHBJbmZvKClcbiAgLnRoZW4oKFtjYXJkcywgdXNlcnNdKSA9PiB7XG4gICAgLy8gRGVzdHJ1Y3R1cmluZyB0aGUgcmVzcG9uc2UgZnJvbSBQcm9taXNlLmFsbCBpbiBBcGkuanNcbiAgICAvLyBVcGRhdGVzIHByb2ZpbGUgaW5mbyBmcm9tIHVzZXIgZGF0YVxuICAgIHByb2ZpbGVOYW1lRWwudGV4dENvbnRlbnQgPSB1c2Vycy5uYW1lO1xuICAgIHByb2ZpbGVEZXNjcmlwdGlvbkVsLnRleHRDb250ZW50ID0gdXNlcnMuYWJvdXQ7XG4gICAgcHJvZmlsZVBob3RvRWwuc3JjID0gdXNlcnMuYXZhdGFyO1xuXG4gICAgY2FyZHMuZm9yRWFjaCgoaXRlbSkgPT4ge1xuICAgICAgY29uc3QgY2FyZEVsZW1lbnQgPSBnZXRDYXJkRWxlbWVudChpdGVtKTtcbiAgICAgIGNhcmRzTGlzdC5hcHBlbmQoY2FyZEVsZW1lbnQpO1xuICAgIH0pO1xuICB9KVxuICAuY2F0Y2goY29uc29sZS5lcnJvcik7XG5cbmNvbnN0IHByb2ZpbGVQaG90b0VsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXJcIik7XG5cbmNvbnN0IGVkaXRQcm9maWxlQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19lZGl0LWJ0blwiKTtcbmNvbnN0IGVkaXRQcm9maWxlTW9kYWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiI2VkaXQtcHJvZmlsZS1tb2RhbFwiKTtcbmNvbnN0IGVkaXRQcm9maWxlQ2xvc2VCdG4gPSBlZGl0UHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ0blwiKTtcbmNvbnN0IGVkaXRQcm9maWxlRm9ybUVsID0gZWRpdFByb2ZpbGVNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuY29uc3QgZWRpdFByb2ZpbGVTdWJtaXRCdG4gPVxuICBlZGl0UHJvZmlsZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idG5cIik7XG5jb25zdCBlZGl0UHJvZmlsZU5hbWVJbnB1dCA9IGVkaXRQcm9maWxlTW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIjcHJvZmlsZS1uYW1lLWlucHV0XCJcbik7XG5jb25zdCBlZGl0RGVzY3JpcHRpb25JbnB1dCA9IGVkaXRQcm9maWxlTW9kYWwucXVlcnlTZWxlY3RvcihcbiAgXCIjcHJvZmlsZS1kZXNjcmlwdGlvbi1pbnB1dFwiXG4pO1xuXG5jb25zdCBuZXdQb3N0QnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hZGQtYnRuXCIpO1xuY29uc3QgbmV3UG9zdE1vZGFsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIiNuZXctcG9zdC1tb2RhbFwiKTtcbmNvbnN0IG5ld1Bvc3RDbG9zZUJ0biA9IG5ld1Bvc3RNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jbG9zZS1idG5cIik7XG5jb25zdCBuZXdQb3N0Rm9ybUVsID0gbmV3UG9zdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Zvcm1cIik7XG5jb25zdCBuZXdQb3N0U3VibWl0QnRuID0gbmV3UG9zdE1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idG5cIik7XG5jb25zdCBuZXdQb3N0SW1hZ2VJbnB1dCA9IG5ld1Bvc3RNb2RhbC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtaW1hZ2UtaW5wdXRcIik7XG5jb25zdCBuZXdQb3N0RGVzY3JpcHRpb25JbnB1dCA9IG5ld1Bvc3RNb2RhbC5xdWVyeVNlbGVjdG9yKFxuICBcIiNjYXJkLWNhcHRpb24taW5wdXRcIlxuKTtcbmNvbnN0IGVkaXRBdmF0YXJNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZWRpdC1hdmF0YXItbW9kYWxcIik7XG5jb25zdCBhdmF0YXJNb2RhbENsb3NlQnRuID0gZWRpdEF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ0blwiKTtcbmNvbnN0IHByb2ZpbGVFZGl0QXZhdGFyQnRuID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19hdmF0YXItYnRuXCIpO1xuY29uc3QgZWRpdEF2YXRhckZvcm1FbCA9IGVkaXRBdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19mb3JtXCIpO1xuY29uc3QgZWRpdEF2YXRhclN1Ym1pdEJ0biA9IGVkaXRBdmF0YXJNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19zdWJtaXQtYnRuXCIpO1xuY29uc3QgZWRpdEF2YXRhcklucHV0ID0gZWRpdEF2YXRhck1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIjcHJvZmlsZS1hdmF0YXItaW5wdXRcIik7XG5cbmNvbnN0IHByZXZpZXdNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjcHJldmlldy1tb2RhbFwiKTtcbmNvbnN0IHByZXZpZXdNb2RhbENsb3NlQnRuID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2Nsb3NlLWJ0blwiKTtcbmNvbnN0IHByZXZpZXdJbWFnZUVsID0gcHJldmlld01vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX2ltYWdlXCIpO1xuY29uc3QgcHJldmlld0NhcHRpb25FbCA9IHByZXZpZXdNb2RhbC5xdWVyeVNlbGVjdG9yKFwiLm1vZGFsX19jYXB0aW9uXCIpO1xuXG5jb25zdCBwcm9maWxlTmFtZUVsID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvcihcIi5wcm9maWxlX19uYW1lXCIpO1xuY29uc3QgcHJvZmlsZURlc2NyaXB0aW9uRWwgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLnByb2ZpbGVfX2Rlc2NyaXB0aW9uXCIpO1xuXG5jb25zdCBkZWxldGVNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIjZGVsZXRlLWF2YXRhci1tb2RhbFwiKTtcbmNvbnN0IGRlbGV0ZU1vZGFsQ2xvc2VCdG4gPSBkZWxldGVNb2RhbC5xdWVyeVNlbGVjdG9yKFxuICBcIi5tb2RhbF9fY2xvc2UtYnRuX2RlbGV0ZVwiXG4pO1xuY29uc3QgY2FuY2VsRGVsZXRlQnRuID0gZGVsZXRlTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fc3VibWl0LWJ0bi1jYW5jbGVcIik7XG5jb25zdCBkZWxldGVGb3JtID0gZGVsZXRlTW9kYWwucXVlcnlTZWxlY3RvcihcIi5tb2RhbF9fZm9ybVwiKTtcbmNvbnN0IGRlbGV0ZVN1Ym1pdEJ0biA9IGRlbGV0ZU1vZGFsLnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfX3N1Ym1pdC1idG5cIik7XG4vLyBEZWxldGUgY2FyZCBmdW5jdGlvbmFsaXR5XG4vLyBUaGVzZSB2YXJpYWJsZXMgdHJhY2sgdGhlIGNhcmQgYmVpbmcgZGVsZXRlZFxubGV0IGRlbGV0ZUNhcmRFbDtcbmxldCBkZWxldGVDYXJkSWQ7XG4vLyB0aGlzIGZ1bmN0aW9uIHdpbGwgYmUgY2FsbGVkIHdoZW4gdGhlIGRlbGV0ZSBidXR0b24gaXMgY2xpY2tlZFxuLy8gaXQgd2lsbCBvcGVuIHRoZSBkZWxldGUgbW9kYWwgYW5kIHNldCB0aGUgY2FyZCB0byBiZSBkZWxldGVkXG4vLyBpdCB3aWxsIGFsc28gc2V0IHRoZSBjYXJkIElEIHRvIGJlIGRlbGV0ZWRcbi8vIGl0IHdpbGwgYWxzbyBzZXQgdGhlIGNhcmQgZWxlbWVudCB0byBiZSBkZWxldGVkXG4vLyB0aGVuIGNsb3NlIHRoZSBtb2RhbFxuZGVsZXRlRm9ybS5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGZ1bmN0aW9uIChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IGV2dC5zdWJtaXR0ZXI7IC8vIEdldCB0aGUgYnV0dG9uIHRoYXQgdHJpZ2dlcmVkIHRoZSBzdWJtaXRcbiAgZGVsZXRlQnV0dG9uVGV4dChzdWJtaXRCdXR0b24sIHRydWUpOyAvLyBTaG93IGxvYWRpbmcgc3RhdGVcblxuICBhcGlcbiAgICAuZGVsZXRlQ2FyZChkZWxldGVDYXJkSWQpXG4gICAgLnRoZW4oKCkgPT4ge1xuICAgICAgZGVsZXRlQ2FyZEVsLnJlbW92ZSgpO1xuICAgICAgY2xvc2VNb2RhbChkZWxldGVNb2RhbCk7XG4gICAgfSlcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcilcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBkZWxldGVCdXR0b25UZXh0KHN1Ym1pdEJ1dHRvbiwgZmFsc2UpOyAvLyBSZXN0b3JlIG9yaWdpbmFsIGJ1dHRvbiB0ZXh0XG4gICAgfSk7XG59KTtcblxuY2FuY2VsRGVsZXRlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gIGNsb3NlTW9kYWwoZGVsZXRlTW9kYWwpO1xufSk7XG5cbmNvbnN0IGNhcmRUZW1wbGF0ZSA9IGRvY3VtZW50XG4gIC5xdWVyeVNlbGVjdG9yKFwiI2NhcmQtdGVtcGxhdGVcIilcbiAgLmNvbnRlbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkXCIpO1xuXG5jb25zdCBjYXJkc0xpc3QgPSBkb2N1bWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRzX19saXN0XCIpO1xuLy90aGlzIGZ1bmN0aW9uIHdpbGwgY3JlYXRlIGEgY2FyZCBlbGVtZW50XG4vLyBpdCB3aWxsIHJldHVybiB0aGUgY2FyZCBlbGVtZW50XG4vL3RoZSBjYXJkIGVsZW1lbnQgd2lsbCBiZSBwb3B1bGF0ZWQgd2l0aCBkYXRhXG4vL3RoZSBjYXJkIGVsZW1lbnQgd2lsbCBoYXZlIGV2ZW50IGxpc3RlbmVycyBmb3IgbGlrZSwgZGVsZXRlIGFuZCBwcmV2aWV3XG5mdW5jdGlvbiBoYW5kbGVMaWtlKGV2dCwgZGF0YSkge1xuICBjb25zdCBpc0xpa2VkID0gZXZ0LnRhcmdldC5jbGFzc0xpc3QuY29udGFpbnMoXCJjYXJkX19saWtlLWJ0bl9hY3RpdmVcIik7XG4gIGFwaVxuICAgIC5jaGFuZ2VMaWtlU3RhdHVzKGRhdGEuX2lkLCBpc0xpa2VkKVxuICAgIC50aGVuKCgpID0+IGV2dC50YXJnZXQuY2xhc3NMaXN0LnRvZ2dsZShcImNhcmRfX2xpa2UtYnRuX2FjdGl2ZVwiKSk7XG59XG5cbmZ1bmN0aW9uIGdldENhcmRFbGVtZW50KGRhdGEpIHtcbiAgbGV0IGNhcmRFbGVtZW50ID0gY2FyZFRlbXBsYXRlLmNsb25lTm9kZSh0cnVlKTtcbiAgY29uc3QgY2FyZFRpdGxlRWwgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX3RpdGxlXCIpO1xuICBjb25zdCBjYXJkSW1hZ2VFbCA9IGNhcmRFbGVtZW50LnF1ZXJ5U2VsZWN0b3IoXCIuY2FyZF9faW1hZ2VcIik7XG4gIGNvbnN0IGNhcmRMaWtlQnRuRWwgPSBjYXJkRWxlbWVudC5xdWVyeVNlbGVjdG9yKFwiLmNhcmRfX2xpa2UtYnRuXCIpO1xuXG4gIGNhcmRJbWFnZUVsLnNyYyA9IGRhdGEubGluaztcbiAgY2FyZEltYWdlRWwuYWx0ID0gZGF0YS5uYW1lO1xuICBjYXJkVGl0bGVFbC50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcblxuICBpZiAoZGF0YS5pc0xpa2VkKSB7XG4gICAgY2FyZExpa2VCdG5FbC5jbGFzc0xpc3QuYWRkKFwiY2FyZF9fbGlrZS1idG5fYWN0aXZlXCIpO1xuICB9XG5cbiAgY2FyZExpa2VCdG5FbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKGV2dCkgPT4ge1xuICAgIGhhbmRsZUxpa2UoZXZ0LCBkYXRhKTtcbiAgfSk7XG5cbiAgY29uc3QgY2FyZERlbGV0ZUJ0bkVsID0gY2FyZEVsZW1lbnQucXVlcnlTZWxlY3RvcihcIi5jYXJkX19kZWxldGUtYnRuXCIpO1xuICBjYXJkRGVsZXRlQnRuRWwuYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsICgpID0+IHtcbiAgICBkZWxldGVDYXJkSWQgPSBkYXRhLl9pZDtcbiAgICBkZWxldGVDYXJkRWwgPSBjYXJkRWxlbWVudDtcbiAgICBvcGVuTW9kYWwoZGVsZXRlTW9kYWwpO1xuICB9KTtcblxuICBjYXJkSW1hZ2VFbC5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgKCkgPT4ge1xuICAgIHByZXZpZXdJbWFnZUVsLnNyYyA9IGRhdGEubGluaztcbiAgICBwcmV2aWV3SW1hZ2VFbC5hbHQgPSBkYXRhLm5hbWU7XG4gICAgcHJldmlld0NhcHRpb25FbC50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcbiAgICBvcGVuTW9kYWwocHJldmlld01vZGFsKTtcbiAgfSk7XG5cbiAgcmV0dXJuIGNhcmRFbGVtZW50O1xufVxuXG5wcmV2aWV3TW9kYWxDbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICBjbG9zZU1vZGFsKHByZXZpZXdNb2RhbCk7XG59KTtcblxuLy90aGlzIGZ1bmN0aW9uIHdpbGwgYmUgY2FsbGVkIHdoZW4gdGhlIG1vZGFsIGlzIG9wZW5lZFxuLy8gaXQgd2lsbCBhZGQgdGhlIG1vZGFsX2lzLW9wZW5lZCBjbGFzcyB0byB0aGUgbW9kYWxcbi8vIGl0IHdpbGwgYWxzbyBhZGQgZXZlbnQgbGlzdGVuZXJzIGZvciBjbGljayBhbmQga2V5ZG93blxuLy8gaXQgd2lsbCBhbHNvIHNldCB0aGUgbW9kYWwgdG8gYmUgY2xvc2VkIHdoZW4gdGhlIG92ZXJsYXkgaXMgY2xpY2tlZFxuZnVuY3Rpb24gb3Blbk1vZGFsKG1vZGFsKSB7XG4gIG1vZGFsLmNsYXNzTGlzdC5hZGQoXCJtb2RhbF9pcy1vcGVuZWRcIik7XG4gIGRvY3VtZW50LmFkZEV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGhhbmRsZUVzY2FwZUtleSk7XG59XG4vL2NhbiBpIGFkZCB0aGUgZXNjYXBlIGFuZCBjbGljayB0byBleGl0IGhlcmVcbi8vaWYgc28gaG93Pz8/XG5mdW5jdGlvbiBjbG9zZU1vZGFsKG1vZGFsKSB7XG4gIG1vZGFsLmNsYXNzTGlzdC5yZW1vdmUoXCJtb2RhbF9pcy1vcGVuZWRcIik7XG4gIGRvY3VtZW50LnJlbW92ZUV2ZW50TGlzdGVuZXIoXCJrZXlkb3duXCIsIGhhbmRsZUVzY2FwZUtleSk7XG59XG5cbi8vZnVuY3Rpb24gaGFuZGxlRXNjYXBlS2V5KGV2ZW50KSB7fVxuLy90aGlzIGZ1bmN0aW9uIHdpbGwgYmUgY2FsbGVkIHdoZW4gdGhlIGVzY2FwZSBrZXkgaXMgcHJlc3NlZFxuZWRpdFByb2ZpbGVCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgcmVzZXRWYWxpZGF0aW9uKFxuICAgIGVkaXRQcm9maWxlRm9ybUVsLFxuICAgIFtlZGl0UHJvZmlsZU5hbWVJbnB1dCwgZWRpdERlc2NyaXB0aW9uSW5wdXRdLFxuICAgIHNldHRpbmdzXG4gICk7IC8vIGZpeFxuICBvcGVuTW9kYWwoZWRpdFByb2ZpbGVNb2RhbCk7XG4gIGVkaXRQcm9maWxlTmFtZUlucHV0LnZhbHVlID0gcHJvZmlsZU5hbWVFbC50ZXh0Q29udGVudDtcbiAgZWRpdERlc2NyaXB0aW9uSW5wdXQudmFsdWUgPSBwcm9maWxlRGVzY3JpcHRpb25FbC50ZXh0Q29udGVudDtcbn0pO1xuXG5lZGl0UHJvZmlsZUNsb3NlQnRuLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCBmdW5jdGlvbiAoKSB7XG4gIGNsb3NlTW9kYWwoZWRpdFByb2ZpbGVNb2RhbCk7XG59KTtcblxubmV3UG9zdEJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICBvcGVuTW9kYWwobmV3UG9zdE1vZGFsKTtcbn0pO1xuXG5uZXdQb3N0Q2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgY2xvc2VNb2RhbChuZXdQb3N0TW9kYWwpO1xufSk7XG5wcm9maWxlRWRpdEF2YXRhckJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICBvcGVuTW9kYWwoZWRpdEF2YXRhck1vZGFsKTtcbn0pO1xuYXZhdGFyTW9kYWxDbG9zZUJ0bi5hZGRFdmVudExpc3RlbmVyKFwiY2xpY2tcIiwgZnVuY3Rpb24gKCkge1xuICBjbG9zZU1vZGFsKGVkaXRBdmF0YXJNb2RhbCk7XG59KTtcbmRlbGV0ZU1vZGFsQ2xvc2VCdG4uYWRkRXZlbnRMaXN0ZW5lcihcImNsaWNrXCIsIGZ1bmN0aW9uICgpIHtcbiAgY2xvc2VNb2RhbChkZWxldGVNb2RhbCk7XG59KTtcblxuLy8gUHJvZmlsZSBmb3JtIHN1Ym1pc3Npb24gd2l0aCBsb2FkaW5nIHN0YXRlXG5mdW5jdGlvbiBoYW5kbGVQcm9maWxlRm9ybVN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IGV2dC5zdWJtaXR0ZXI7IC8vIEdldCB0aGUgYnV0dG9uIHRoYXQgdHJpZ2dlcmVkIHRoZSBzdWJtaXRcbiAgc2V0QnV0dG9uVGV4dChzdWJtaXRCdXR0b24sIHRydWUpO1xuXG4gIGFwaVxuICAgIC5lZGl0VXNlckluZm8oe1xuICAgICAgbmFtZTogZWRpdFByb2ZpbGVOYW1lSW5wdXQudmFsdWUsXG4gICAgICBhYm91dDogZWRpdERlc2NyaXB0aW9uSW5wdXQudmFsdWUsXG4gICAgfSlcbiAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgLy8gVXBkYXRlIHByb2ZpbGUgaW5mbyB3aXRoIEFQSSByZXNwb25zZVxuICAgICAgcHJvZmlsZU5hbWVFbC50ZXh0Q29udGVudCA9IGRhdGEubmFtZTtcbiAgICAgIHByb2ZpbGVEZXNjcmlwdGlvbkVsLnRleHRDb250ZW50ID0gZGF0YS5hYm91dDtcbiAgICAgIHByb2ZpbGVQaG90b0VsLnNyYyA9IGRhdGEuYXZhdGFyO1xuICAgICAgZGlzYWJsZUJ1dHRvbihlZGl0UHJvZmlsZVN1Ym1pdEJ0biwgc2V0dGluZ3MpO1xuICAgICAgY2xvc2VNb2RhbChlZGl0UHJvZmlsZU1vZGFsKTtcbiAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHNldEJ1dHRvblRleHQoc3VibWl0QnV0dG9uLCBmYWxzZSk7XG4gICAgfSk7XG59XG5cbmVkaXRQcm9maWxlRm9ybUVsLmFkZEV2ZW50TGlzdGVuZXIoXCJzdWJtaXRcIiwgaGFuZGxlUHJvZmlsZUZvcm1TdWJtaXQpO1xuZWRpdEF2YXRhckZvcm1FbC5hZGRFdmVudExpc3RlbmVyKFwic3VibWl0XCIsIGhhbmRsZUF2YXRhclN1Ym1pdCk7XG5cbi8vIEF2YXRhciBmb3JtIHN1Ym1pc3Npb24gd2l0aCBsb2FkaW5nIHN0YXRlXG5mdW5jdGlvbiBoYW5kbGVBdmF0YXJTdWJtaXQoZXZ0KSB7XG4gIGV2dC5wcmV2ZW50RGVmYXVsdCgpO1xuICBjb25zdCBzdWJtaXRCdXR0b24gPSBldnQuc3VibWl0dGVyOyAvLyBHZXQgdGhlIGJ1dHRvbiB0aGF0IHRyaWdnZXJlZCB0aGUgc3VibWl0XG4gIHNldEJ1dHRvblRleHQoc3VibWl0QnV0dG9uLCB0cnVlKTtcbiAgYXBpXG4gICAgLmVkaXRVc2VyQXZhdGFyKHtcbiAgICAgIGF2YXRhcjogZWRpdEF2YXRhcklucHV0LnZhbHVlLFxuICAgIH0pXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgIHByb2ZpbGVQaG90b0VsLnNyYyA9IGRhdGEuYXZhdGFyOyAvLyBVcGRhdGUgYXZhdGFyIHdpdGggQVBJIHJlc3BvbnNlXG4gICAgICBjbG9zZU1vZGFsKGVkaXRBdmF0YXJNb2RhbCk7XG4gICAgICBldnQudGFyZ2V0LnJlc2V0KCk7XG4gICAgICBkaXNhYmxlQnV0dG9uKGVkaXRBdmF0YXJTdWJtaXRCdG4sIHNldHRpbmdzKTtcbiAgICB9KVxuICAgIC5jYXRjaChjb25zb2xlLmVycm9yKVxuICAgIC5maW5hbGx5KCgpID0+IHtcbiAgICAgIHNldEJ1dHRvblRleHQoc3VibWl0QnV0dG9uLCBmYWxzZSk7IC8vIFJlc3RvcmUgb3JpZ2luYWwgYnV0dG9uIHRleHRcbiAgICB9KTtcbn1cblxuLy8gQWRkIGNhcmQgZm9ybSBzdWJtaXNzaW9uIHdpdGggbG9hZGluZyBzdGF0ZVxuZnVuY3Rpb24gaGFuZGxlQWRkQ2FyZFN1Ym1pdChldnQpIHtcbiAgZXZ0LnByZXZlbnREZWZhdWx0KCk7XG4gIGNvbnN0IHN1Ym1pdEJ1dHRvbiA9IGV2dC5zdWJtaXR0ZXI7XG4gIHNldEJ1dHRvblRleHQoc3VibWl0QnV0dG9uLCB0cnVlKTtcblxuICBjb25zdCBpbnB1dFZhbHVlcyA9IHtcbiAgICBuYW1lOiBuZXdQb3N0RGVzY3JpcHRpb25JbnB1dC52YWx1ZSxcbiAgICBsaW5rOiBuZXdQb3N0SW1hZ2VJbnB1dC52YWx1ZSxcbiAgfTtcblxuICBhcGlcbiAgICAuYWRkQ2FyZHMoaW5wdXRWYWx1ZXMpXG4gICAgLnRoZW4oKGRhdGEpID0+IHtcbiAgICAgIGNvbnN0IGNhcmRFbGVtZW50ID0gZ2V0Q2FyZEVsZW1lbnQoZGF0YSk7IC8vIENyZWF0ZSBuZXcgY2FyZCBlbGVtZW50XG4gICAgICBjYXJkc0xpc3QucHJlcGVuZChjYXJkRWxlbWVudCk7IC8vIEFkZCBpdCB0byB0aGUgcGFnZSBpbW1lZGlhdGVseVxuICAgICAgZXZ0LnRhcmdldC5yZXNldCgpO1xuICAgICAgZGlzYWJsZUJ1dHRvbihuZXdQb3N0U3VibWl0QnRuLCBzZXR0aW5ncyk7XG4gICAgICBjbG9zZU1vZGFsKG5ld1Bvc3RNb2RhbCk7XG4gICAgfSlcbiAgICAuY2F0Y2goY29uc29sZS5lcnJvcilcbiAgICAuZmluYWxseSgoKSA9PiB7XG4gICAgICBzZXRCdXR0b25UZXh0KHN1Ym1pdEJ1dHRvbiwgZmFsc2UpOyAvLyBSZXN0b3JlIG9yaWdpbmFsIGJ1dHRvbiB0ZXh0XG4gICAgfSk7XG59XG5cbm5ld1Bvc3RGb3JtRWwuYWRkRXZlbnRMaXN0ZW5lcihcInN1Ym1pdFwiLCBoYW5kbGVBZGRDYXJkU3VibWl0KTtcblxuZnVuY3Rpb24gaGFuZGxlRXNjYXBlS2V5KGV2ZW50KSB7XG4gIGlmIChldmVudC5rZXkgPT09IFwiRXNjYXBlXCIpIHtcbiAgICBjb25zdCBvcGVuZWRNb2RhbCA9IGRvY3VtZW50LnF1ZXJ5U2VsZWN0b3IoXCIubW9kYWxfaXMtb3BlbmVkXCIpO1xuXG4gICAgY2xvc2VNb2RhbChvcGVuZWRNb2RhbCk7XG4gIH1cbn1cblxuY29uc3QgbW9kYWxzID0gZG9jdW1lbnQucXVlcnlTZWxlY3RvckFsbChcIi5tb2RhbFwiKTtcblxubW9kYWxzLmZvckVhY2goKG1vZGFsKSA9PiB7XG4gIG1vZGFsLmFkZEV2ZW50TGlzdGVuZXIoXCJjbGlja1wiLCAoZXZlbnQpID0+IHtcbiAgICBpZiAoZXZlbnQudGFyZ2V0LmNsYXNzTGlzdC5jb250YWlucyhcIm1vZGFsXCIpKSB7XG4gICAgICBjbG9zZU1vZGFsKG1vZGFsKTtcbiAgICB9XG4gIH0pO1xufSk7XG5cbmVuYWJsZVZhbGlkYXRpb24oc2V0dGluZ3MpO1xuIiwiY2xhc3MgQXBpIHtcbiAgY29uc3RydWN0b3IoeyBiYXNlVXJsLCBoZWFkZXJzIH0pIHtcbiAgICB0aGlzLl9iYXNlVXJsID0gYmFzZVVybDtcbiAgICB0aGlzLl9oZWFkZXJzID0gaGVhZGVycztcbiAgfVxuXG4gIF9oYW5kbGVTZXJ2ZXJSZXNwb25zZShyZXMpIHtcbiAgICBpZiAocmVzLm9rKSB7XG4gICAgICByZXR1cm4gcmVzLmpzb24oKTtcbiAgICB9XG4gICAgcmV0dXJuIFByb21pc2UucmVqZWN0KGBFcnJvcjogJHtyZXMuc3RhdHVzfWApO1xuICB9XG5cbiAgZ2V0QXBwSW5mbygpIHtcbiAgICByZXR1cm4gUHJvbWlzZS5hbGwoW3RoaXMuZ2V0SW5pdGlhbENhcmRzKCksIHRoaXMuZ2V0VXNlckluZm8oKV0pO1xuICB9XG5cbiAgYXN5bmMgZ2V0SW5pdGlhbENhcmRzKCkge1xuICAgIGNvbnN0IHJlcyA9IGF3YWl0IGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L2NhcmRzYCwge1xuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KTtcbiAgICByZXR1cm4gdGhpcy5faGFuZGxlU2VydmVyUmVzcG9uc2UocmVzKTtcbiAgfVxuXG4gIGdldFVzZXJJbmZvKCkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZWAsIHtcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbih0aGlzLl9oYW5kbGVTZXJ2ZXJSZXNwb25zZSk7XG4gIH1cblxuICBlZGl0VXNlckluZm8oeyBuYW1lLCBhYm91dCB9KSB7XG4gICAgcmV0dXJuIGZldGNoKGAke3RoaXMuX2Jhc2VVcmx9L3VzZXJzL21lYCwge1xuICAgICAgbWV0aG9kOiBcIlBBVENIXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgLy8gU2VuZCB0aGUgZGF0YSBpbiB0aGUgYm9keSBhcyBhIEpTT04gc3RyaW5nLlxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBuYW1lLFxuICAgICAgICBhYm91dCxcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4oKHJlcykgPT4ge1xuICAgICAgcmV0dXJuIHRoaXMuX2hhbmRsZVNlcnZlclJlc3BvbnNlKHJlcyk7XG4gICAgfSk7XG4gIH1cblxuICBhZGRDYXJkcyh7IG5hbWUsIGxpbmsgfSkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkc2AsIHtcbiAgICAgIG1ldGhvZDogXCJQT1NUXCIsXG4gICAgICBoZWFkZXJzOiB0aGlzLl9oZWFkZXJzLFxuICAgICAgLy8gU2VuZCB0aGUgZGF0YSBpbiB0aGUgYm9keSBhcyBhIEpTT04gc3RyaW5nLlxuICAgICAgYm9keTogSlNPTi5zdHJpbmdpZnkoe1xuICAgICAgICBuYW1lLFxuICAgICAgICBsaW5rLFxuICAgICAgfSksXG4gICAgfSkudGhlbigocmVzKSA9PiB7XG4gICAgICByZXR1cm4gdGhpcy5faGFuZGxlU2VydmVyUmVzcG9uc2UocmVzKTtcbiAgICB9KTtcbiAgfVxuXG5cbiAgY2hhbmdlTGlrZVN0YXR1cyhjYXJkSWQsIGlzTGlrZWQpIHtcbiAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS9jYXJkcy8ke2NhcmRJZH0vbGlrZXNgLCB7XG4gICAgICBtZXRob2Q6IGlzTGlrZWQgPyBcIkRFTEVURVwiIDogXCJQVVRcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgfSkudGhlbih0aGlzLl9oYW5kbGVTZXJ2ZXJSZXNwb25zZSk7XG5cbiAgfVxuXG5cbiAgZWRpdFVzZXJBdmF0YXIoeyBhdmF0YXIgfSkge1xuICAgIHJldHVybiBmZXRjaChgJHt0aGlzLl9iYXNlVXJsfS91c2Vycy9tZS9hdmF0YXJgLCB7XG4gICAgICBtZXRob2Q6IFwiUEFUQ0hcIixcbiAgICAgIGhlYWRlcnM6IHRoaXMuX2hlYWRlcnMsXG4gICAgICAvLyBTZW5kIHRoZSBkYXRhIGluIHRoZSBib2R5IGFzIGEgSlNPTiBzdHJpbmcuXG4gICAgICBib2R5OiBKU09OLnN0cmluZ2lmeSh7XG4gICAgICAgIGF2YXRhcixcbiAgICAgIH0pLFxuICAgIH0pLnRoZW4odGhpcy5faGFuZGxlU2VydmVyUmVzcG9uc2UpO1xuICB9XG5cbiAgZGVsZXRlQ2FyZChjYXJkSWQpIHtcbiAgICByZXR1cm4gZmV0Y2goYCR7dGhpcy5fYmFzZVVybH0vY2FyZHMvJHtjYXJkSWR9YCwge1xuICAgICAgbWV0aG9kOiBcImRlbGV0ZVwiLFxuICAgICAgaGVhZGVyczogdGhpcy5faGVhZGVycyxcbiAgICB9KS50aGVuKHRoaXMuX2hhbmRsZVNlcnZlclJlc3BvbnNlKTtcbiAgfVxufVxuXG5leHBvcnQgZGVmYXVsdCBBcGk7XG4iXSwibmFtZXMiOlsic2V0dGluZ3MiLCJmb3JtU2VsZWN0b3IiLCJpbnB1dFNlbGVjdG9yIiwic3VibWl0QnV0dG9uU2VsZWN0b3IiLCJpbmFjdGl2ZUJ1dHRvbkNsYXNzIiwiaW5wdXRFcnJvckNsYXNzIiwiZXJyb3JDbGFzcyIsImhpZGVJbnB1dEVycm9yIiwiZm9ybUVsIiwiaW5wdXRFbCIsImNvbmZpZyIsInF1ZXJ5U2VsZWN0b3IiLCJpZCIsInRleHRDb250ZW50IiwiY2xhc3NMaXN0IiwicmVtb3ZlIiwidG9nZ2xlQnV0dG9uU3RhdGUiLCJpbnB1dExpc3QiLCJidXR0b25FbCIsInNvbWUiLCJpbnB1dCIsInZhbGlkaXR5IiwidmFsaWQiLCJoYXNJbnZhbGlkSW5wdXQiLCJkaXNhYmxlQnV0dG9uIiwiZGlzYWJsZWQiLCJjb25zb2xlIiwibG9nIiwiYWRkIiwic2V0QnV0dG9uVGV4dCIsImJ1dHRvbiIsImlzTG9hZGluZyIsImRlZmF1bHRUZXh0IiwibG9hZGluZ1RleHQiLCJkZWxldGVCdXR0b25UZXh0IiwiYXBpIiwiY29uc3RydWN0b3IiLCJiYXNlVXJsIiwiaGVhZGVycyIsInRoaXMiLCJfYmFzZVVybCIsIl9oZWFkZXJzIiwiX2hhbmRsZVNlcnZlclJlc3BvbnNlIiwicmVzIiwib2siLCJqc29uIiwiUHJvbWlzZSIsInJlamVjdCIsInN0YXR1cyIsImdldEFwcEluZm8iLCJhbGwiLCJnZXRJbml0aWFsQ2FyZHMiLCJnZXRVc2VySW5mbyIsImZldGNoIiwidGhlbiIsImVkaXRVc2VySW5mbyIsIm5hbWUiLCJhYm91dCIsIm1ldGhvZCIsImJvZHkiLCJKU09OIiwic3RyaW5naWZ5IiwiYWRkQ2FyZHMiLCJsaW5rIiwiY2hhbmdlTGlrZVN0YXR1cyIsImNhcmRJZCIsImlzTGlrZWQiLCJlZGl0VXNlckF2YXRhciIsImF2YXRhciIsImRlbGV0ZUNhcmQiLCJhdXRob3JpemF0aW9uIiwiY2FyZHMiLCJ1c2VycyIsInByb2ZpbGVOYW1lRWwiLCJwcm9maWxlRGVzY3JpcHRpb25FbCIsInByb2ZpbGVQaG90b0VsIiwic3JjIiwiZm9yRWFjaCIsIml0ZW0iLCJjYXJkRWxlbWVudCIsImdldENhcmRFbGVtZW50IiwiY2FyZHNMaXN0IiwiYXBwZW5kIiwiY2F0Y2giLCJlcnJvciIsImRvY3VtZW50IiwiZWRpdFByb2ZpbGVCdG4iLCJlZGl0UHJvZmlsZU1vZGFsIiwiZWRpdFByb2ZpbGVDbG9zZUJ0biIsImVkaXRQcm9maWxlRm9ybUVsIiwiZWRpdFByb2ZpbGVTdWJtaXRCdG4iLCJlZGl0UHJvZmlsZU5hbWVJbnB1dCIsImVkaXREZXNjcmlwdGlvbklucHV0IiwibmV3UG9zdEJ0biIsIm5ld1Bvc3RNb2RhbCIsIm5ld1Bvc3RDbG9zZUJ0biIsIm5ld1Bvc3RGb3JtRWwiLCJuZXdQb3N0U3VibWl0QnRuIiwibmV3UG9zdEltYWdlSW5wdXQiLCJuZXdQb3N0RGVzY3JpcHRpb25JbnB1dCIsImVkaXRBdmF0YXJNb2RhbCIsImF2YXRhck1vZGFsQ2xvc2VCdG4iLCJwcm9maWxlRWRpdEF2YXRhckJ0biIsImVkaXRBdmF0YXJGb3JtRWwiLCJlZGl0QXZhdGFyU3VibWl0QnRuIiwiZWRpdEF2YXRhcklucHV0IiwicHJldmlld01vZGFsIiwicHJldmlld01vZGFsQ2xvc2VCdG4iLCJwcmV2aWV3SW1hZ2VFbCIsInByZXZpZXdDYXB0aW9uRWwiLCJkZWxldGVNb2RhbCIsImRlbGV0ZU1vZGFsQ2xvc2VCdG4iLCJjYW5jZWxEZWxldGVCdG4iLCJkZWxldGVGb3JtIiwiZGVsZXRlQ2FyZEVsIiwiZGVsZXRlQ2FyZElkIiwiYWRkRXZlbnRMaXN0ZW5lciIsImV2dCIsInByZXZlbnREZWZhdWx0Iiwic3VibWl0QnV0dG9uIiwic3VibWl0dGVyIiwiY2xvc2VNb2RhbCIsImZpbmFsbHkiLCJjYXJkVGVtcGxhdGUiLCJjb250ZW50IiwiZGF0YSIsImNsb25lTm9kZSIsImNhcmRUaXRsZUVsIiwiY2FyZEltYWdlRWwiLCJjYXJkTGlrZUJ0bkVsIiwiYWx0IiwidGFyZ2V0IiwiY29udGFpbnMiLCJfaWQiLCJ0b2dnbGUiLCJoYW5kbGVMaWtlIiwib3Blbk1vZGFsIiwibW9kYWwiLCJoYW5kbGVFc2NhcGVLZXkiLCJyZW1vdmVFdmVudExpc3RlbmVyIiwiZXZlbnQiLCJrZXkiLCJyZXNldFZhbGlkYXRpb24iLCJ2YWx1ZSIsInJlc2V0IiwiaW5wdXRWYWx1ZXMiLCJwcmVwZW5kIiwicXVlcnlTZWxlY3RvckFsbCIsInNldEV2ZW50TGlzdG5lcnMiLCJBcnJheSIsImZyb20iLCJjaGVja0lucHV0VmFsaWRpdHkiLCJzaG93SW5wdXRFcnJvciIsImVycm9yTXNnIiwidmFsaWRhdGlvbk1lc3NhZ2UiXSwic291cmNlUm9vdCI6IiJ9